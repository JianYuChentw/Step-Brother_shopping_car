<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>商品詳情</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC&family=Raleway:ital@1&display=swap"
      rel="stylesheet"
    />
    <style>
      body {
        font-family: Arial, sans-serif;
        margin: 0;
        padding: 0;
        background-color: #f0f0f0;
      }

      nav {
        background-color: #007bff;
        color: white;
        padding: 10px 0;
        display: flex;
        justify-content: center;
      }

      nav a {
        color: white;
        text-decoration: none;
        margin: 0 15px;
        font-size: 1.2rem;
        font-family: 'Noto Sans TC', sans-serif;
        font-family: 'Raleway', sans-serif;
      }

      #productDetails {
        max-width: 600px;
        margin: 20px auto;
        padding: 20px;
        background-color: #fff;
        box-shadow: 0px 0px 10px rgba(0, 0, 0, 0.1);
        border-radius: 5px;
      }

      h1 {
        font-size: 2rem;
        margin-bottom: 20px;
        color: #007bff;
      }

      #productInfo {
        margin-top: 20px;
        font-family: 'Noto Sans TC', sans-serif;
        font-family: 'Raleway', sans-serif;
      }

      h2 {
        font-size: 1.5rem;
        margin-bottom: 10px;
      }

      p {
        margin: 5px 0;
      }

      #sizeStock {
        margin-top: 20px;
      }

      #sizeStock p {
        font-size: 1rem;
      }
    </style>
  </head>
  <body>
    <nav>
      <a href="/">首頁</a>
      <a href="/stepbrothers/man">男</a>
      <a href="/stepbrothers/woman">女</a>
      <a href="/stepbrothers/kid">童</a>
      <a href="/stepbrothers/about">關於</a>
      <a href="/userpage">使用者</a>
      <a href="/stepbrothers/shopping_history">歷史訂單</a>
      <a href="/stepbrothers/shopping_car">購物車</a>
      <a href="/login">登入頁</a>
      <a href="/stepbrothers/logout">登出</a>
      <a href="/stepbrothers/register_page">註冊頁</a>
    </nav>
    <div id="productDetails">
      <h1>商品詳情</h1>
      <div id="productInfo">
        <h2 id="productName"></h2>
        <p id="productDescription"></p>
        <p id="productPrice"></p>
        <div id="sizeStock">
          <!-- 商品尺寸和庫存將顯示於此 -->
        </div>
      </div>
    </div>

    <script>
      // 獲取URL中的商品ID
      function getProductIdFromURL() {
        const path = window.location.pathname; // 獲取當前頁面的路徑
        const pathSegments = path.split('/'); // 將路徑拆分為段落
        const productIdIndex = pathSegments.indexOf('stepbrothers'); // 找到商品ID所在的段落索引

        return pathSegments[1]; // 返回商品ID
      }

      // 獲取商品信息
      async function fetchProductDetails(id) {
        try {
          const response = await fetch(`/stepbrothers/${id}`);
          const data = await response.json();

          if (response.ok) {
            // 更新頁面上的商品信息
            document.getElementById('productName').textContent =
              data.product_name;
            document.getElementById('productDescription').textContent =
              data.product_description;
            document.getElementById(
              'productPrice'
            ).textContent = `價格：${data.price}元`; // 更新為data.price

            // 渲染尺寸和庫存信息
            const sizeStockDiv = document.getElementById('sizeStock');
            sizeStockDiv.innerHTML = ''; // 清空之前的內容

            data.size_stock.forEach((sizeStock) => {
              const sizeStockItem = document.createElement('p');
              sizeStockItem.textContent = `Size ${sizeStock.size}: 庫存尚餘： ${sizeStock.stock}`;
              sizeStockDiv.appendChild(sizeStockItem);
            });
          } else {
            // 處理錯誤
            console.error('獲取商品信息時發生錯誤：', false);
            return false;
          }
        } catch (error) {
          console.error('發生網絡錯誤：', error);
        }
      }

      // 頁面加載後獲取商品信息
      window.addEventListener('load', () => {
        const productId = getProductIdFromURL(); // 獲取商品ID
        if (productId) {
          fetchProductDetails(productId);
        } else {
          console.error('未找到商品ID。');
        }
      });
    </script>
  </body>
</html>
